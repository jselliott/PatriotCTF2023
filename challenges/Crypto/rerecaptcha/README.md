# ReReCaptcha

## Description

Boy these captcha's are getting out of hand! First it was some numbers and letters, then they wanted me to find all the crosswalks and stoplights, now, I just got these 4 images in a zip file as the captcha.

*Flag format: PCTF{}*

*Author: @meatball5201*

## Files

* [ReReCaptcha.zip](files/ReReCaptcha.zip)

## Solution

Using the script below, we can use OCR to grab the relevant numbers from each file.

```python
import pytesseract
from PIL import Image
import zipfile
import io

zip_file_path = 'captcha.zip'
numbers_by_file = {}

with zipfile.ZipFile(zip_file_path, 'r') as zip_file:
    for file_info in zip_file.infolist():
        with zip_file.open(file_info) as image_file:
            image_data = io.BytesIO(image_file.read())
            image = Image.open(image_data)
            text = pytesseract.image_to_string(image)

            numbers_by_file[file_info.filename] = text.strip().replace('\n', '')

print("Extracted numbers from images:")
for filename, numbers in numbers_by_file.items():
    print(f"File: {filename}")
    print(numbers)
    print()
```

We can then use these values to compute N and decrypt the ciphertext.

```python
from Crypto.Util.number import long_to_bytes

def egcd(a, b):
    x,y, u,v = 0,1, 1,0
    while a != 0:
        q, r = b//a, b%a
        m, n = x-u*q, y-v*q
        b,a, x,y, u,v = a,r, u,v, m,n
        gcd = b
    return gcd, x, y

def main():
    p = 7527565288418755379118789957530427076474039495543602083672348770256244095402036827619210939155084186558527991001416646223350394559200222136096290672620194046126089002573360386593945150101317675173
057700316606471628486091098227506432346405018697409551766559221455707084352171005229868679760065796785568861540646342004018597383111352750465452533499482446950296601400868072892711411018627895197517923591
176491459985639613689428210227397923927166207167955929720553146932674003689276217756458335550664768069962889032841021939171934241000687175363437889931960990549836012868054326027883264698694686444486185583
762669459368222607046399890727374413013120165732458568705964510138621688460411449629769138288402047039035190589255542166789323375789824161838155744235939032031400618213129792883048948055291135484453597540
209164579615434056700434993786181497421632771003680753769768381924812350959136243541142152894864273583373712496459340912621586984787690809449131910182836822992274485485726201782117587752263992487363518238
832534254288596088398229677484177507507686789971916315914538558932103335242240408103004160072749522484357238490351377136090192610067378320509257519686534889414957624453789692368934902209319606170823721750
80757226428538037
    q = 8803989692514528873086609175044861825628469040762871212917631687192741367465664916782680375109055919907717988697827144203833465583973723938489509441206456492083214567582946673775066189473181551915
568665645106601935615196852212174018096535176437390844707120093383196201539117509481781873779885806706212766634354295130391941665246658483310785092427784613259080286256126451766470575519315094238460254803
659635132783562148038255836216563447739681569358221167132942712097162083329669587140334985754001009294326576994446974083417845801906741057097454593159063741448156437290667991084937174177536267352666109651
588884223495374817925754797014288771952303835682966025945538057936621381893578843605997661372509874453885582079473059498759161347500044343797673324121276924817772696548994110408630410938731281871308227080
398647736593779904530771825596205792732076017215430202328681374833734381093370188063335169650075077161830757689263363702694937070286531987440314209440674628659000962477051919207175751497035243357062167592
909200647239735079256741892427443718905662784266026896968964427120466103067327980316488655497720619874492496816125345999586041351369953257908601589629600397275561756249485524067629858316407423202900626311
20287472335619521
    e = 65537
    ct = 547590045996470261225144068564632591573787420865767654212444036810572966678309584960972626777469094681032974328164904149749600259672136934210403710935407987419571508025184041271895067424156324469
024810966606852261431391688357761512441188128187458484503164121214384836360742836216967714420625882111057022247970965942848303921794789346337737893197243612818268465250465877044258806243922230727023881404
970938005953190967778288998431676016702769147989927719939182760311480334264809421162220015621090135416401880927503987522127265969654408291660790352126419357164108533856843237323171953026076531105728648328
324923086143326956880262885203796912258527629468067372572383012312176987519524843551719189468646956945850613317182997989942974331541493738246229851690400679853822266008368822574537577425351978286434342026
984605691841085815076342812086868023146780043716604629194888656921833024316612560619555137422446188904342302733188575919468514004498619801759424982795897844061952346726879066178817850934595446457909109453
837848675711241549430795712234153989264410262939683540458865005615713268101445833037375744808596085053241804888891701971868711759992716579549993335302912988330587350904650760602395488347207624117794040982
092935808682384669215975260316456957005280536323748748451859327148084313706338115025237168232332534517867166295513314043649722568822723980570806206350360190837033224939468341892520615348593265252930033163
747357910048800707270329959279250125176893733926396824275827180145794109603384095258309396482826564465328137465494645467473805118722935849245504408363355846668577679514586108364779800765168640592142304039
838955302308914087893023063252032349069709839176651451588638893935334633671625047109023175942570562397231739366947453236019232243950959163541616500487920026686827091185458918470395565313445637882007182680
733646365466964964492493047008454896836188780586371966370294876198020858848707820674621729887685898963936365043959397213677672399150215969434394621340356476956194967721227263377291913870111556540279774436
032833389518938555906361035170116045111581111048932758951598288290256975575396734603373938570048755291566401584397815342661811437979695992858063766385621604576552328916703837820995591294013715783944373602
881462604795099961134208159255804708926010191436116381452002653737716505049107799043258685780634928186042043269235310046607045310234994163743652142826561145366664556272951154058573009377757365555437978827
13184445755824314743287083
    # compute n
    n = p * q
    # Compute phi(n)
    phi = (p - 1) * (q - 1)
    # Compute modular inverse of e
    gcd, a, b = egcd(e, phi)
    d = a
   # Decrypt ciphertext
    pt = pow(ct, d, n)
    print("Flag is : " + str(long_to_bytes(pt).decode()))
if __name__ == "__main__":
    main()
```

```
PCTF{I_H0P3_U_U53D_0CR!}
```
